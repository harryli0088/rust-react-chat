{"version":3,"sources":["Components/Chat/Chat.tsx","github.svg","App.tsx","reportWebVitals.ts","index.tsx"],"names":["Chat","showSenderAddr","props","displaySenderAddr","senderAddr","className","this","content","type","React","Component","App","lastDate","Date","lastSenderAddr","lastType","pingInterval","socket","setUpSocket","setState","socketReadyState","WebSocket","process","location","pathname","replace","onopen","addChat","readyState","clearInterval","window","setInterval","ping","onmessage","message","console","log","parsed","JSON","parse","data","addChatFromSocket","sender_addr","type_key","err","error","onclose","send","date","chat","chats","state","concat","getConnectionStatus","onChatTypeSubmit","e","preventDefault","input","trim","onNewRoomSubmit","newRoomURI","encodeURIComponent","newRoom","history","push","prevProps","close","connectionStatus","id","map","m","i","onSubmit","autoFocus","onChange","target","value","disabled","href","rel","src","github","alt","clientPackage","version","htmlFor","placeholder","withRouter","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.75ce2fa8.chunk.js","sourcesContent":["import React from 'react';\nimport \"./chat.scss\"\n\nexport type ChatType = {\n  content: React.ReactNode,\n  date: Date,\n  senderAddr: string,\n  showSenderAddr: boolean,\n  type: string,\n}\n\ninterface State {}\n\nclass Chat extends React.Component<ChatType,State> {\n\n  showSenderAddr = () => {\n    if(this.props.showSenderAddr) {\n      const displaySenderAddr = this.props.senderAddr===\"self\" ? \"You\" : this.props.senderAddr\n\n      return (\n        <div className=\"sender\">{displaySenderAddr}</div>\n      )\n    }\n  }\n\n  render() {\n    if(this.props.content) {\n      return (\n        <div className=\"message-container\">\n          <div className={`message ${this.props.senderAddr} ${this.props.type}`}>\n            <div>\n              {this.showSenderAddr()}\n              <span className=\"content\">\n                {\n                  typeof this.props.content === \"string\"\n                  ? <pre>{this.props.content}</pre>\n                  : this.props.content\n                }\n              </span>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return null;\n  }\n}\n\nexport default Chat;\n","export default __webpack_public_path__ + \"static/media/github.7ef381bc.svg\";","import React from 'react'\nimport Chat, { ChatType } from \"Components/Chat/Chat\"\nimport github from \"github.svg\"\nimport { withRouter, RouteComponentProps } from \"react-router\"\nimport clientPackage from \"../package.json\"\nimport 'App.scss'\n\ntype Props = RouteComponentProps\n\ninterface State {\n  input: string,\n  chats: ChatType[],\n  newRoom: string,\n  socketReadyState: number,\n}\n\nconst WS_SERVER_URL = process.env.REACT_APP_WS_SERVER_URL || \"ws://localhost:8080\"\n\nclass App extends React.Component<Props,State> {\n  lastDate: Date = new Date()\n  lastSenderAddr: string = \"\"\n  lastType: string = \"\"\n  pingInterval: number = -1\n  socket: WebSocket\n\n  constructor(props:Props) {\n    super(props)\n\n    this.state = {\n      input: \"\",\n      chats: [\n        // {\n        //   content: \"testing testing 123\",\n        //   date: new Date(),\n        //   senderAddr: \"tessdadfadfadfasfsdsdasfafdfafdfasfadt\",\n        //   showSenderAddr: true,\n        //   type: \"user\",\n        // },\n        // {\n        //   content: \"testing testing 123\",\n        //   date: new Date(),\n        //   senderAddr: \"self\",\n        //   showSenderAddr: true,\n        //   type: \"user\",\n        // },\n        // {\n        //   content: \"testing testing 123\",\n        //   date: new Date(),\n        //   senderAddr: \"self\",\n        //   showSenderAddr: false,\n        //   type: \"user\",\n        // },\n        // {\n        //   content: \"testing testing 123\",\n        //   date: new Date(),\n        //   senderAddr: \"self\",\n        //   showSenderAddr: false,\n        //   type: \"user\",\n        // },\n      ],\n      newRoom: \"\",\n      socketReadyState: 0,\n    }\n\n    this.socket = this.setUpSocket()\n  }\n\n  componentDidUpdate(prevProps:Props) {\n    if(prevProps.location.pathname !== this.props.location.pathname) {\n      this.socket.close()\n      this.socket = this.setUpSocket()\n    }\n  }\n\n  componentWillUnmount() {\n    this.socket.close()\n  }\n\n  setUpSocket = () => {\n    this.setState({socketReadyState: 0})\n    const socket = new WebSocket(WS_SERVER_URL, this.props.location.pathname.replace(/\\//ig, \"-\"))\n    socket.onopen = () => {\n      this.addChat(<span>You have joined the chat room <span className=\"blob\">{this.props.location.pathname}</span></span>, \"self\", \"meta\")\n      this.setState({socketReadyState: socket.readyState})\n      clearInterval(this.pingInterval)\n      this.pingInterval = window.setInterval(this.ping, 30000)\n    }\n\n    socket.onmessage = (message:MessageEvent<any>) => {\n      console.log(\"MESSAGE\", message)\n\n      try {\n        const parsed = JSON.parse(message.data)\n        this.addChatFromSocket(parsed.message, parsed.sender_addr, parsed.type_key)\n      }\n      catch(err) {\n        console.error(err)\n      }\n\n    }\n\n    socket.onclose = () => {\n      this.setState({socketReadyState: socket.readyState})\n    }\n\n    return socket\n  }\n\n  ping = () => this.socket.send(\"\")\n\n  addChatFromSocket = (content: string, senderAddr:string, type: string) => {\n    this.addChat(content, senderAddr, type) //add the chat to state\n\n    this.setState({ //update the socket state\n      socketReadyState: this.socket.readyState,\n    })\n  }\n\n  addChat = (content: React.ReactNode, senderAddr:string, type: string) => {\n    const date = new Date()\n    const chat:ChatType = {\n      content,\n      date,\n      senderAddr,\n      showSenderAddr: this.lastSenderAddr !== senderAddr\n      || this.lastType !== type, //set whether we should show the sender addr\n      type,\n    }\n\n    //record last values\n    this.lastDate = date\n    this.lastSenderAddr = chat.senderAddr\n    this.lastType = chat.type\n\n    this.setState({ //add the chat to state\n      chats: this.state.chats.concat(chat),\n    })\n  }\n\n  getConnectionStatus = () => {\n    switch(this.state.socketReadyState) {\n      case 0:\n        return \"Connecting\"\n      case 1:\n        return \"Connected\"\n      case 2:\n        return \"Closing\"\n      default:\n        return \"Closed\"\n    }\n  }\n\n  onChatTypeSubmit = (e:React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n\n    const content = this.state.input.trim() //trim the input of any white space\n\n    if(content) {\n      this.socket.send(content) //send the chat to the socket\n\n      this.addChat(content, \"self\", \"user\") //add this chat to state\n\n      this.setState({ input: \"\" }) //clear the input\n    }\n  }\n\n  onNewRoomSubmit = (e:React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n\n    const newRoomURI = encodeURIComponent(this.state.newRoom)\n\n    this.props.history.push(newRoomURI)\n  }\n\n  render() {\n    const connectionStatus = this.getConnectionStatus()\n\n    return (\n      <div id=\"App\">\n        <div id=\"content\">\n          <div id=\"header\" className=\"container\">\n            Current Room: <span  className=\"blob\">{this.props.location.pathname}</span> <span className={`blob  ${connectionStatus}`}>{connectionStatus}</span>\n          </div>\n\n          <div id=\"chat-container\" className=\"container\">\n            <div>\n              {this.state.chats.map((m,i) =>\n                <Chat key={i} {...m}/>\n              )}\n            </div>\n          </div>\n\n          <div id=\"chat-form-container\">\n            <form id=\"chat-form\" onSubmit={this.onChatTypeSubmit}>\n              <input\n                autoFocus\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => this.setState({input: e.target.value})}\n                value={this.state.input}\n              />\n\n              <button type=\"submit\" disabled={this.state.socketReadyState !== 1}>Send</button>\n            </form>\n          </div>\n        </div>\n\n        <div id=\"sidebar\">\n          <a id=\"github\" href=\"https://github.com/harryli0088/rust-react-chat\" target=\"_blank\" rel=\"noopener noreferrer\"><img src={github} alt=\"github repo\"/></a>\n\n          <h2>React - Rust Chat App</h2>\n          <p>Version {clientPackage.version}</p>\n          <p>I created this chat room prototype to learn how to use Rust. The Rust server features include:</p>\n          <ul>\n            <li>WebSocket server</li>\n            <li>Chat rooms distinguished by route (via WebSocket protocol)</li>\n            <li>Alerts when a client connects or disconnects</li>\n          </ul>\n          <p>(Note: Heroku free tier server takes several seconds to wake up from sleep mode)</p>\n\n          <hr/>\n\n          <form id=\"new-room-form\" onSubmit={this.onNewRoomSubmit}>\n            <br/>\n            <label htmlFor=\"new-room-input\">Change Rooms:</label>\n            <div>\n              <input\n                id=\"new-room-input\"\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) => this.setState({newRoom: e.target.value})}\n                placeholder=\"Enter a new room code\"\n                value={this.state.newRoom}\n              />&nbsp;\n\n              <button type=\"submit\">Change</button>\n            </div>\n            <br/>\n          </form>\n\n          <hr/>\n\n          <div>\n\t\t          <p>Built using <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">React</a>, <a href=\"https://www.typescriptlang.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Typescript</a>, <a href=\"https://fontawesome.com/license\" target=\"_blank\" rel=\"noopener noreferrer\">Font Awesome</a>, and <a href=\"https://www.rust-lang.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Rust</a></p>\n\t\t            <p><a href=\"https://github.com/harryli0088/rust-react-chat\" target=\"_blank\" rel=\"noopener noreferrer\">Github Repo</a></p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default withRouter(App)\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'index.scss';\nimport App from 'App';\nimport reportWebVitals from 'reportWebVitals';\nimport { HashRouter } from \"react-router-dom\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}